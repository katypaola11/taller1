<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista Autor Libros - Portal de Letras</title>

    <!-- Inter web font from bunny.net (GDPR compliant) -->
    <link rel="preconnect" href="https://fonts.bunny.net" />
    <link
            href="https://fonts.bunny.net/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
            rel="stylesheet"
    />

    <!-- Tailwind CSS Play CDN -->
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>

    <!-- Tailwind CSS v4 Configuration -->
    <style type="text/tailwindcss">
        /* Class based dark mode */
        @custom-variant dark (&:where(.dark, .dark *));

        /* Theme configuration */
        @theme {
          /* Fonts */
          --default-font-family: "Inter";
        }
    </style>

    <!-- Alpine.js -->
    <script
            defer
            src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <!-- Alpine.js (x-cloak) -->
    <style>
        [x-cloak] {
          display: none !important;
        }
    </style>
</head>
<body class="antialiased">
<!-- Page Container -->
<div
        x-data="{
        darkMode: false,
        mobileMenu: false,
        toggleDarkMode() {
          this.darkMode = ! this.darkMode;
          if (this.darkMode) {
            document.body.parentNode.classList.add('dark');
          } else {
            document.body.parentNode.classList.remove('dark');
          }
        },
        toggleMobileMenu() {
          this.mobileMenu = ! this.mobileMenu;
        }
      }"
        class="min-h-dvh min-w-80 bg-white text-zinc-800 dark:bg-zinc-950 dark:text-zinc-100"
>
    <!-- Page Content -->
    <main class="mx-auto flex max-w-6xl flex-auto flex-col px-4 pb-4 lg:px-8 lg:pb-8">

        <!-- Navigation Header -->
        <header class="flex flex-none items-center justify-between py-7">
            <div class="flex items-center gap-3">
                <!-- Logo -->
                <a th:href="@{/index}" class="flex items-center gap-2 text-2xl font-thin tracking-widest hover:text-purple-600 active:opacity-75 dark:hover:text-purple-400">
                    <span class="text-3xl">üìö</span>
                    <span class="hidden sm:inline">Portal de Letras</span>
                    <span class="sm:hidden">Biblioteca</span>
                </a>

                <!-- Toggle Dark Mode -->
                <button
                        x-on:click="toggleDarkMode()"
                        type="button"
                        class="relative inline-flex size-9 items-center justify-center text-zinc-600 hover:opacity-75 dark:text-zinc-400"
                >
                    <div
                            x-cloak
                            x-show="!darkMode"
                            x-transition:enter="transition ease-out duration-150"
                            x-transition:enter-start="opacity-0 rotate-180"
                            x-transition:enter-end="opacity-100 rotate-0"
                            x-transition:leave="transition ease-in duration-100"
                            x-transition:leave-start="opacity-100 rotate-0"
                            x-transition:leave-end="opacity-0 rotate-180"
                            class="absolute inset-0 flex items-center justify-center"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" />
                        </svg>
                    </div>
                    <div
                            x-cloak
                            x-show="darkMode"
                            x-transition:enter="transition ease-out duration-150"
                            x-transition:enter-start="opacity-0 rotate-180"
                            x-transition:enter-end="opacity-100 rotate-0"
                            x-transition:leave="transition ease-in duration-100"
                            x-transition:leave-start="opacity-100 rotate-0"
                            x-transition:leave-end="opacity-0 rotate-180"
                            class="absolute inset-0 flex items-center justify-center"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" />
                        </svg>
                    </div>
                </button>
            </div>

            <!-- Desktop Navigation -->
            <div class="hidden md:flex items-center gap-6">
                <nav class="flex items-center gap-6">
                    <a th:href="@{/index}" class="text-sm font-medium decoration-purple-600 decoration-2 underline-offset-8 hover:text-black hover:underline dark:decoration-purple-400 dark:hover:text-white">
                        Inicio
                    </a>
                    <a th:href="@{/autores}" class="text-sm font-medium decoration-purple-600 decoration-2 underline-offset-8 hover:text-black hover:underline dark:decoration-purple-400 dark:hover:text-white">
                        Autores
                    </a>
                    <a th:href="@{/libros}" class="text-sm font-medium decoration-purple-600 decoration-2 underline-offset-8 hover:text-black hover:underline dark:decoration-purple-400 dark:hover:text-white">
                        Libros
                    </a>
                </nav>
            </div>

            <!-- Mobile Menu Button -->
            <button
                    x-on:click="toggleMobileMenu()"
                    class="md:hidden relative inline-flex size-9 items-center justify-center text-zinc-600 hover:opacity-75 dark:text-zinc-400"
            >
                <svg x-show="!mobileMenu" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg>
                <svg x-show="mobileMenu" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </header>

        <!-- Mobile Navigation -->
        <div x-show="mobileMenu" x-transition class="md:hidden mb-6 rounded-xl bg-zinc-100 p-4 dark:bg-zinc-900">
            <nav class="flex flex-col space-y-3">
                <a th:href="@{/index}" class="text-sm font-medium hover:text-purple-600 dark:hover:text-purple-400">Inicio</a>
                <a th:href="@{/autores}" class="text-sm font-medium hover:text-purple-600 dark:hover:text-purple-400">Autores</a>
                <a th:href="@{/libros}" class="text-sm font-medium hover:text-purple-600 dark:hover:text-purple-400">Libros</a>
                <a th:href="@{/catalogo}" class="text-sm font-medium hover:text-purple-600 dark:hover:text-purple-400">Autores</a>
            </nav>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 gap-8">

            <!-- Author Hero Section -->
            <div class="relative col-span-1 flex flex-col overflow-hidden rounded-xl bg-zinc-100 p-8 lg:p-12 dark:bg-zinc-900">
                <div aria-hidden="true" class="absolute -top-20 -left-20 size-48 rounded-full bg-emerald-400 blur-2xl"></div>
                <div aria-hidden="true" class="absolute -top-10 -right-10 size-64 rounded-full bg-purple-300 blur-3xl"></div>
                <div aria-hidden="true" class="absolute inset-0 bg-emerald-100/50 backdrop-blur-md dark:bg-emerald-900/75"></div>

                <div class="relative">
                    <div class="flex flex-col lg:flex-row items-start lg:items-center gap-6">
                        <div class="flex-shrink-0">
                            <div class="w-24 h-24 lg:w-32 lg:h-32 rounded-xl bg-gradient-to-br from-emerald-400 to-teal-600 flex items-center justify-center text-white text-4xl lg:text-5xl font-bold">
                                ‚úçÔ∏è
                            </div>
                        </div>
                        <div class="flex-1">
                            <h1 class="text-3xl lg:text-4xl font-medium text-black dark:text-white mb-4" th:text="${autor.nombre}">
                                Autor
                            </h1>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-lg">
                                <div class="flex items-center gap-3">
                                    <span class="text-2xl">üåç</span>
                                    <div>
                                        <span class="text-zinc-600 dark:text-zinc-400">Nacionalidad:</span>
                                        <span class="ml-2 font-medium text-zinc-900 dark:text-zinc-200" th:text="${autor.nacionalidad}"></span>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3">
                                    <span class="text-2xl">üìÖ</span>
                                    <div>
                                        <span class="text-zinc-600 dark:text-zinc-400">Nacimiento:</span>
                                        <span class="ml-2 font-medium text-zinc-900 dark:text-zinc-200" th:text="${#dates.format(autor.fechaNacimiento, 'dd/MM/yyyy')}"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Books Section -->
            <div class="col-span-1">
                <div class="flex items-center justify-between mb-8">
                    <h2 class="text-3xl font-medium text-black dark:text-white flex items-center gap-3">
                        <span>üìñ</span> Obras del Autor
                    </h2>
                    <div class="text-sm text-zinc-600 dark:text-zinc-400">
                        <span th:text="${#lists.size(librosAutor)}">0</span> libros disponibles
                    </div>
                </div>

                <!-- Books Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" th:if="${not #lists.isEmpty(librosAutor)}">
                    <div th:each="libro : ${librosAutor}" class="group relative overflow-hidden rounded-xl bg-zinc-100 p-6 hover:bg-zinc-200/75 active:bg-zinc-200 dark:bg-zinc-900 dark:hover:bg-zinc-800/75 dark:active:bg-zinc-800 transition-all duration-200">
                        <!-- Book Cover -->
                        <div class="mb-6">
                            <div class="h-48 bg-gradient-to-br from-blue-400 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold text-4xl transition duration-150 ease-out group-hover:scale-105 shadow-lg">
                                üìö
                            </div>
                        </div>

                        <!-- Book Info -->
                        <div class="mb-6">
                            <h3 class="text-lg font-medium text-zinc-950 dark:text-zinc-50 mb-2" th:text="${libro.titulo}">
                                T√≠tulo del Libro
                            </h3>
                            <div class="space-y-1 text-sm text-zinc-600 dark:text-zinc-400">
                                <div class="flex items-center gap-2">
                                    <span>üè¢</span>
                                    <span th:text="${libro.editorial}">Editorial</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span>üìÑ</span>
                                    <span th:text="${libro.paginas} + ' p√°ginas'">P√°ginas</span>
                                </div>
                            </div>
                        </div>



                        <!-- Actions -->
                        <div class="flex flex-col gap-2">
                            <a th:href="@{/libros/view/{id}(id=${libro.id})}"
                               target="_blank"
                               class="w-full px-4 py-2 text-center text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 rounded-lg transition duration-200 ease-in-out">
                                üìñ Leer en l√≠nea
                            </a>
                            <button class="w-full px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-lg transition duration-200 ease-in-out"
                                    th:onclick="'descargarLibro(' + ${libro.id} + ')'"
                                    th:data-titulo="${libro.titulo}">
                                üíæ Descargar PDF
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div th:if="${#lists.isEmpty(librosAutor)}" class="text-center py-12">
                    <div class="text-6xl mb-4">üìö</div>
                    <h3 class="text-xl font-medium text-zinc-900 dark:text-zinc-100 mb-2">
                        No hay libros disponibles
                    </h3>
                    <p class="text-zinc-600 dark:text-zinc-400">
                        Este autor a√∫n no tiene obras registradas en nuestra biblioteca.
                    </p>
                </div>
            </div>

            <!-- Navigation Section -->
            <div class="col-span-1 flex justify-center">
                <a th:href="@{/autores}"
                   class="inline-flex items-center gap-2 px-6 py-3 text-white bg-zinc-600 hover:bg-zinc-700 rounded-xl transition duration-200 ease-in-out font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
                    </svg>
                    Volver a Autores
                </a>
            </div>
        </div>
    </main>
</div>

<!-- Modal para leer en l√≠nea -->
<div id="modalLectura" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8);">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; height: 90%; background: white; border-radius: 8px; padding: 20px;">
        <span id="cerrarModal" style="position: absolute; top: 15px; right: 25px; font-size: 28px; cursor: pointer;">&times;</span>
        <h3 id="tituloLibro" style="margin-bottom: 20px; font-size: 24px; font-weight: bold;"></h3>
        <iframe id="pdfViewer" style="width: 100%; height: calc(100% - 80px); border: none;"></iframe>
    </div>
</div>

<!-- Mensaje de descarga -->
<div id="mensajeDescarga" style="display: none; position: fixed; top: 20px; right: 20px; background: #4CAF50; color: white; padding: 15px 20px; border-radius: 5px; z-index: 1001;">
    Descarga iniciada...
</div>



<script>
    function leerEnLinea(libroId) {
        // Obtener datos del libro
        fetch('/api/libro/' + libroId)
            .then(response => response.json())
            .then(libro => {
                // Mostrar el modal
                document.getElementById('modalLectura').style.display = 'block';
                document.getElementById('tituloLibro').textContent = libro.titulo;

                // Cargar el PDF en el iframe
                document.getElementById('pdfViewer').src = '/pdf/view/' + libroId;
            })
            .catch(error => {
                console.error('Error al cargar el libro:', error);
                alert('Error al cargar el libro. Int√©ntalo de nuevo.');
            });
    }

    function descargarLibro(libroId) {
        // Obtener el t√≠tulo desde el atributo data-titulo
        const boton = event.target;
        const titulo = boton.getAttribute('data-titulo');

        // Mostrar mensaje de descarga
        const mensaje = document.getElementById('mensajeDescarga');
        mensaje.style.display = 'block';

        // Crear enlace de descarga
        const link = document.createElement('a');
        link.href = '/pdf/download/' + libroId;
        link.download = titulo + '.pdf';
        link.style.display = 'none';

        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        // Ocultar mensaje despu√©s de 3 segundos
        setTimeout(() => {
            mensaje.style.display = 'none';
        }, 3000);
    }

    // Cerrar modal
    document.getElementById('cerrarModal').onclick = function() {
        document.getElementById('modalLectura').style.display = 'none';
        document.getElementById('pdfViewer').src = '';
    }

    // Cerrar modal al hacer clic fuera de √©l
    window.onclick = function(event) {
        const modal = document.getElementById('modalLectura');
        if (event.target == modal) {
            modal.style.display = 'none';
            document.getElementById('pdfViewer').src = '';
        }
    }

    // Cerrar modal con ESC
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            const modal = document.getElementById('modalLectura');
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.getElementById('pdfViewer').src = '';
            }
        }
    });
</script>
</body>
</html>
